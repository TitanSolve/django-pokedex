{% extends "_base.html" %}
{% load poke_extras %}
{% block content %}
<section class="glass p-4 p-md-5 mb-4">
  <div class="d-flex align-items-center">
    <div>
      <h1 class="display-6 fw-bold mb-1 text-white">Catch ‘em all</h1>
      <p class="text-white-50 mb-3">Search, filter by type or ability, and explore detailed stats.</p>
    </div>
  </div>

  {% if error %}
    <div class="alert alert-trans">{{ error }}</div>
  {% endif %}

  <form class="row g-3 mt-2" method="get">
    <div class="col-lg-4">
      <input name="q" class="form-control form-control-lg" placeholder="Search by name..." value="{{ q }}">
    </div>
    <div class="col-lg-3">
      <select class="form-select form-select-lg" name="type">
        <option value="">All Types</option>
        {% for t in types %}
          <option value="{{ t.name }}" {% if t.name == type_selected %}selected{% endif %}>{{ t.name|capfirst }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-lg-3">
      <select class="form-select form-select-lg" name="ability">
        <option value="">All Abilities</option>
        {% for a in abilities %}
          <option value="{{ a }}" {% if a == ability_selected %}selected{% endif %}>{{ a|capfirst }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-lg-2 d-grid">
      <button class="btn btn-primary btn-lg"><i class="bi bi-search"></i> Apply</button>
    </div>
  </form>
</section>

<div class="row g-4">
  {% for p in pokemon_list %}
    <div class="col-6 col-sm-4 col-md-3 col-xl-2">
      <a class="text-decoration-none" href="/pokemon/{{ p.name }}/">
        <div class="glass p-3 h-100 text-center text-white">
          <img class="img-fluid mb-2" alt="{{ p.name }}" src="{{ p|sprite_url }}">
          <div class="fw-bold text-truncate">{{ p.name|capfirst }}</div>
          <div class="mt-1">{% for t in p.types %}<span class="poke-badge">{{ t.type.name }}</span>{% endfor %}</div>
        </div>
      </a>
    </div>
  {% endfor %}
</div>

<div class="d-flex justify-content-between align-items-center mt-4">
  <div class="text-white-50">Total: {{ total }}</div>
  <div class="btn-group">
    {% if has_prev %}
      <a class="btn btn-outline-light" href="?q={{ q }}&type={{ type_selected }}&ability={{ ability_selected }}&page={{ page|add:'-1' }}&page_size={{ page_size }}">« Prev</a>
    {% else %}<a class="btn btn-outline-light disabled">« Prev</a>{% endif %}
    <span class="btn btn-light disabled">Page {{ page }}</span>
    {% if has_next %}
      <a class="btn btn-outline-light" href="?q={{ q }}&type={{ type_selected }}&ability={{ ability_selected }}&page={{ page|add:'1' }}&page_size={{ page_size }}">Next »</a>
    {% else %}<a class="btn btn-outline-light disabled">Next »</a>{% endif %}
  </div>
</div>
{% endblock %}
